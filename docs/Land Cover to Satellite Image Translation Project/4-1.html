<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Training a Pix2Pix Model – Land Cover to Satellite Image Translation with Pix2Pix GAN Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-b5e3097ca6bab6260ed4ce2e73d47aae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6bf0b08ca396cf31294168bc13d35783.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Land Cover to Satellite Image Translation Project/4-1.html">Training a Pix2Pix Model</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/project-icon.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/Jiayue-Ma" title="Personal Github Profile" class="quarto-navigation-tool px-1" aria-label="Personal Github Profile"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Land Cover to Satellite Image Translation Project/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setting Up Environment and Installing Necessary Packages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Land Cover to Satellite Image Translation Project/1-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hardware Requirements</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Land Cover to Satellite Image Translation Project/1-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installing Anaconda</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Land Cover to Satellite Image Translation Project/1-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setting up a new virtual environment and installing Tensorflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Land Cover to Satellite Image Translation Project/1-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installing other necessary packages</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Land Cover to Satellite Image Translation Project/2-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Importing Packages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Land Cover to Satellite Image Translation Project/3-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Acquisition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Land Cover to Satellite Image Translation Project/4-1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Training a Pix2Pix Model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Land Cover to Satellite Image Translation Project/5-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generating New Images</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Land Cover to Satellite Image Translation Project/6-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conclusion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About Me</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#step-1" id="toc-step-1" class="nav-link active" data-scroll-target="#step-1">Step 1</a></li>
  <li><a href="#step-2" id="toc-step-2" class="nav-link" data-scroll-target="#step-2">Step 2</a></li>
  <li><a href="#step-3" id="toc-step-3" class="nav-link" data-scroll-target="#step-3">Step 3</a></li>
  <li><a href="#step-4" id="toc-step-4" class="nav-link" data-scroll-target="#step-4">Step 4</a></li>
  <li><a href="#step-5" id="toc-step-5" class="nav-link" data-scroll-target="#step-5">Step 5</a></li>
  <li><a href="#step-6" id="toc-step-6" class="nav-link" data-scroll-target="#step-6">Step 6</a></li>
  <li><a href="#step-7" id="toc-step-7" class="nav-link" data-scroll-target="#step-7">Step 7</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Training a Pix2Pix Model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This section outlines the process of training the Pix2Pix model to translate land cover maps into corresponding satellite images. The training involves preparing the dataset, building the model architecture with a generator and discriminator, and optimizing it through iterative learning. By using paired images of land cover and satellite data, the model learns to generate realistic satellite images that correspond to given land cover inputs. This step is essential for enabling the model to learn the relationship between land cover and satellite imagery, ensuring it can produce accurate and realistic outputs for various landscapes.</p>
<section id="step-1" class="level2">
<h2 class="anchored" data-anchor-id="step-1">Step 1</h2>
<p><strong style="color: #CD6AA3;">First, we need to transform and prepare the datasets used in training/testing.</strong> In this step, we begin with concatenating images from the land cover image folder and satellite image folder by same names. Then, we separate these images into three folders – training, validation and test by an 8:1:1 proportion. After which we jitter these images randomly to adjust to the needs of a Pix2Pix model, and store these images in train_dataset and test_dataset.</p>
<div id="2082aa69-eb6b-45af-8668-0635ae105dbb" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="33862ad0-45eb-4386-8cb0-249c2f26e220" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>lc_dir <span class="op">=</span> <span class="st">'24-1204_training_images_2/LC'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>tc_dir <span class="op">=</span> <span class="st">'24-1204_training_images_2/RC'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>training_dir <span class="op">=</span> <span class="st">'24-1204_training_images_2/training'</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>val_dir <span class="op">=</span> <span class="st">'24-1204_training_images_2/validation'</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>test_dir <span class="op">=</span> <span class="st">'24-1204_training_images_2/test'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>os.makedirs(training_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>os.makedirs(val_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>os.makedirs(test_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>all_filenames <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(lc_dir) <span class="cf">if</span> f.endswith((<span class="st">'.png'</span>, <span class="st">'.jpg'</span>, <span class="st">'.jpeg'</span>))]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>np.random.shuffle(all_filenames)  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>num_images <span class="op">=</span> <span class="bu">len</span>(all_filenames)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>num_val <span class="op">=</span> <span class="bu">int</span>(num_images <span class="op">*</span> <span class="fl">0.1</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>num_test <span class="op">=</span> <span class="bu">int</span>(num_images <span class="op">*</span> <span class="fl">0.1</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>val_filenames <span class="op">=</span> all_filenames[:num_val]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>test_filenames <span class="op">=</span> all_filenames[num_val:num_val <span class="op">+</span> num_test]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>train_filenames <span class="op">=</span> all_filenames[num_val <span class="op">+</span> num_test:]</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_and_save_images(filenames, target_dir):</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> filenames:</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        lc_path <span class="op">=</span> os.path.join(lc_dir, filename)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        tc_name <span class="op">=</span> filename.replace(<span class="st">'_pillow'</span>, <span class="st">''</span>)  </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        tc_path <span class="op">=</span> os.path.join(tc_dir, tc_name)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.exists(tc_path):</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            lc_image <span class="op">=</span> Image.<span class="bu">open</span>(lc_path).resize((<span class="dv">256</span>, <span class="dv">256</span>))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            tc_image <span class="op">=</span> Image.<span class="bu">open</span>(tc_path).resize((<span class="dv">256</span>, <span class="dv">256</span>))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>            combined_image <span class="op">=</span> Image.new(<span class="st">'RGB'</span>, (<span class="dv">512</span>, <span class="dv">256</span>))  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>            combined_image.paste(lc_image, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            combined_image.paste(tc_image, (<span class="dv">256</span>, <span class="dv">0</span>))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>            output_path <span class="op">=</span> os.path.join(target_dir, tc_name)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>            combined_image.save(output_path)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Saved combined image: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Image not found for: </span><span class="sc">{</span>tc_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>process_and_save_images(val_filenames, val_dir)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>process_and_save_images(test_filenames, test_dir)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>process_and_save_images(train_filenames, training_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="182d79a2-b912-48c3-bb1d-185d51702610" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sample_path <span class="op">=</span> <span class="st">'24-1204_training_images_2/training'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sample_files <span class="op">=</span> os.listdir(sample_path)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>sample_image <span class="op">=</span> tf.io.read_file(os.path.join(sample_path, sample_files[<span class="dv">0</span>]))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>sample_image <span class="op">=</span> tf.io.decode_jpeg(sample_image)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sample_image.shape)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>)) </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>ax.imshow(sample_image)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>) </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(256, 512, 3)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-4-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="6e015d20-743a-41bc-8dbd-281776e6c897" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load(image_file):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read and decode an image file to a uint8 tensor</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> tf.io.read_file(image_file)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> tf.io.decode_jpeg(image)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split each image tensor into two tensors:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># - one with a real color satellite image</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># - one with a land cover image </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> tf.shape(image)[<span class="dv">1</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> w <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    input_image <span class="op">=</span> image[:, :w, :]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    real_image <span class="op">=</span> image[:, w:, :]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert both images to float32 tensors</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    input_image <span class="op">=</span> tf.cast(input_image, tf.float32)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    real_image <span class="op">=</span> tf.cast(real_image, tf.float32)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input_image, real_image</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>inp, re <span class="op">=</span> load(os.path.join(sample_path, sample_files[<span class="dv">0</span>]))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))  </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].imshow(inp <span class="op">/</span> <span class="fl">255.0</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axis(<span class="st">'off'</span>)  </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Land Cover Image"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, family<span class="op">=</span><span class="st">"Calibri"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].imshow(re <span class="op">/</span> <span class="fl">255.0</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axis(<span class="st">'off'</span>)  </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Satellite Image"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, family<span class="op">=</span><span class="st">"Calibri"</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="b9bbf5fe-30af-422d-b964-6952e37813d5" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The satellite training set consist of 1000 images</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>BUFFER_SIZE <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The batch size of 1 produced better results for the U-Net in the original pix2pix experiment</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Each image is 256x256 in size</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>IMG_WIDTH <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>IMG_HEIGHT <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> resize(input_image, real_image, height, width):</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    input_image <span class="op">=</span> tf.image.resize(input_image, [height, width],</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                                method<span class="op">=</span>tf.image.ResizeMethod.NEAREST_NEIGHBOR)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    real_image <span class="op">=</span> tf.image.resize(real_image, [height, width],</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                               method<span class="op">=</span>tf.image.ResizeMethod.NEAREST_NEIGHBOR)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input_image, real_image</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_crop(input_image, real_image):</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    stacked_image <span class="op">=</span> tf.stack([input_image, real_image], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    cropped_image <span class="op">=</span> tf.image.random_crop(</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      stacked_image, size<span class="op">=</span>[<span class="dv">2</span>, IMG_HEIGHT, IMG_WIDTH, <span class="dv">3</span>])</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cropped_image[<span class="dv">0</span>], cropped_image[<span class="dv">1</span>]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizing the images to [-1, 1]</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize(input_image, real_image):</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    input_image <span class="op">=</span> (input_image <span class="op">/</span> <span class="fl">127.5</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    real_image <span class="op">=</span> (real_image <span class="op">/</span> <span class="fl">127.5</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input_image, real_image</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="at">@tf.function</span>()</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_jitter(input_image, real_image):</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Resizing to 286x286</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> resize(input_image, real_image, <span class="dv">286</span>, <span class="dv">286</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random cropping back to 256x256</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> random_crop(input_image, real_image)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tf.random.uniform(()) <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Random mirroring</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        input_image <span class="op">=</span> tf.image.flip_left_right(input_image)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        real_image <span class="op">=</span> tf.image.flip_left_right(real_image)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input_image, real_image</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  rj_inp, rj_re <span class="op">=</span> random_jitter(inp, re)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  plt.subplot(<span class="dv">1</span>, <span class="dv">4</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  plt.imshow(rj_inp <span class="op">/</span> <span class="fl">255.0</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  plt.axis(<span class="st">'off'</span>)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  plt.subplot(<span class="dv">2</span>, <span class="dv">4</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  plt.imshow(rj_re <span class="op">/</span> <span class="fl">255.0</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  plt.axis(<span class="st">'off'</span>)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8a42713a-e578-41ba-a425-7e439b99516b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_image_train(image_file):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> load(image_file)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> random_jitter(input_image, real_image)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> normalize(input_image, real_image)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input_image, real_image</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_image_test(image_file):</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> load(image_file)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> resize(input_image, real_image,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                                   IMG_HEIGHT, IMG_WIDTH)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    input_image, real_image <span class="op">=</span> normalize(input_image, real_image)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input_image, real_image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ee7078d2-f279-4edd-b4b7-c8d7272758f8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>all_path <span class="op">=</span> <span class="st">'24-1204_training_images_2'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> tf.data.Dataset.list_files(<span class="bu">str</span>(all_path <span class="op">+</span> <span class="st">'/training/*.png'</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> train_dataset.<span class="bu">map</span>(load_image_train,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                                  num_parallel_calls<span class="op">=</span>tf.data.AUTOTUNE)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> train_dataset.shuffle(BUFFER_SIZE)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> train_dataset.batch(BATCH_SIZE)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    test_dataset <span class="op">=</span> tf.data.Dataset.list_files(<span class="bu">str</span>(all_path <span class="op">+</span><span class="st">'/test/*.png'</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> tf.errors.InvalidArgumentError:</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    test_dataset <span class="op">=</span> tf.data.Dataset.list_files(<span class="bu">str</span>(all_path <span class="op">+</span> <span class="st">'/validation/*.png'</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> test_dataset.<span class="bu">map</span>(load_image_test)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> test_dataset.batch(BATCH_SIZE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2" class="level2">
<h2 class="anchored" data-anchor-id="step-2">Step 2</h2>
<p><strong style="color: #CD6AA3;">The main part of model building process</strong> is scraped from <a href="https://www.kaggle.com/code/khaledsayedaaaaa/image-to-image-translation-with-a-conditional-gan">this Kaggle project by Khaled Sayed</a>, where it uses 400 256X256 pixel images to translate colored blocks representation of façade to actual façade image. We take a similar approach by training on 256X256 pixel land cover/satellite images. Empirically speaking, GAN model doesn’t really work well beyond this scale.</p>
</section>
<section id="step-3" class="level2">
<h2 class="anchored" data-anchor-id="step-3">Step 3</h2>
<p><strong style="color: #CD6AA3;">We begin with building a generator</strong> – one of the two major components of a GAN model. We first define a downsampler which translates the spatial dimension of images to “depth” of image and a upsampler which does vice versa. We then combine these two processes to make the generator capable of downsampling land cover images and upsampling to a satellite image with learned convolutional filters. We can examine the structure of this generator by running tf.keras.utils.plot_model(generator, show_shapes=True, dpi=64), while the generator_loss() function helps us examine the performance of generator (the loss should be as small as possible as long as keeping a balance with discriminator loss).</p>
<div id="5f5aab07-029f-411d-9be7-4144a522a2c1" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>OUTPUT_CHANNELS <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> downsample(filters, size, apply_batchnorm<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  initializer <span class="op">=</span> tf.random_normal_initializer(<span class="fl">0.</span>, <span class="fl">0.02</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> tf.keras.Sequential()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  result.add(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      tf.keras.layers.Conv2D(filters, size, strides<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="st">'same'</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                             kernel_initializer<span class="op">=</span>initializer, use_bias<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> apply_batchnorm:</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    result.add(tf.keras.layers.BatchNormalization())</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  result.add(tf.keras.layers.LeakyReLU())</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>down_model <span class="op">=</span> downsample(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>down_result <span class="op">=</span> down_model(tf.expand_dims(inp, <span class="dv">0</span>))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (down_result.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1, 128, 128, 3)</code></pre>
</div>
</div>
<div id="c811c00f-601e-4bf4-b734-54867e479025" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upsample(filters, size, apply_dropout<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  initializer <span class="op">=</span> tf.random_normal_initializer(<span class="fl">0.</span>, <span class="fl">0.02</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> tf.keras.Sequential()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  result.add(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    tf.keras.layers.Conv2DTranspose(filters, size, strides<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                                    padding<span class="op">=</span><span class="st">'same'</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                                    kernel_initializer<span class="op">=</span>initializer,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                    use_bias<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  result.add(tf.keras.layers.BatchNormalization())</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> apply_dropout:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      result.add(tf.keras.layers.Dropout(<span class="fl">0.5</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  result.add(tf.keras.layers.ReLU())</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>up_model <span class="op">=</span> upsample(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>up_result <span class="op">=</span> up_model(down_result)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (up_result.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1, 256, 256, 3)</code></pre>
</div>
</div>
<div id="e53a0288-9797-44c2-970f-6f19c7777c5a" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Generator():</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  inputs <span class="op">=</span> tf.keras.layers.Input(shape<span class="op">=</span>[<span class="dv">256</span>, <span class="dv">256</span>, <span class="dv">3</span>])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  down_stack <span class="op">=</span> [</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">64</span>, <span class="dv">4</span>, apply_batchnorm<span class="op">=</span><span class="va">False</span>),  <span class="co"># (batch_size, 128, 128, 64)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">128</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 64, 64, 128)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">256</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 32, 32, 256)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">512</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 16, 16, 512)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">512</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 8, 8, 512)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">512</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 4, 4, 512)</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">512</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 2, 2, 512)</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    downsample(<span class="dv">512</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 1, 1, 512)</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  up_stack <span class="op">=</span> [</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    upsample(<span class="dv">512</span>, <span class="dv">4</span>, apply_dropout<span class="op">=</span><span class="va">True</span>),  <span class="co"># (batch_size, 2, 2, 1024)</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    upsample(<span class="dv">512</span>, <span class="dv">4</span>, apply_dropout<span class="op">=</span><span class="va">True</span>),  <span class="co"># (batch_size, 4, 4, 1024)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    upsample(<span class="dv">512</span>, <span class="dv">4</span>, apply_dropout<span class="op">=</span><span class="va">True</span>),  <span class="co"># (batch_size, 8, 8, 1024)</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    upsample(<span class="dv">512</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 16, 16, 1024)</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    upsample(<span class="dv">256</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 32, 32, 512)</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    upsample(<span class="dv">128</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 64, 64, 256)</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    upsample(<span class="dv">64</span>, <span class="dv">4</span>),  <span class="co"># (batch_size, 128, 128, 128)</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  initializer <span class="op">=</span> tf.random_normal_initializer(<span class="fl">0.</span>, <span class="fl">0.02</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  last <span class="op">=</span> tf.keras.layers.Conv2DTranspose(OUTPUT_CHANNELS, <span class="dv">4</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                                         strides<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                                         padding<span class="op">=</span><span class="st">'same'</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                                         kernel_initializer<span class="op">=</span>initializer,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>                                         activation<span class="op">=</span><span class="st">'tanh'</span>)  <span class="co"># (batch_size, 256, 256, 3)</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> inputs</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Downsampling through the model</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  skips <span class="op">=</span> []</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> down <span class="kw">in</span> down_stack:</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> down(x)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    skips.append(x)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  skips <span class="op">=</span> <span class="bu">reversed</span>(skips[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Upsampling and establishing the skip connections</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> up, skip <span class="kw">in</span> <span class="bu">zip</span>(up_stack, skips):</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> up(x)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> tf.keras.layers.Concatenate()([x, skip])</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> last(x)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> tf.keras.Model(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cc2854cd-49d8-4497-b687-a727b2ac9dd4" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> Generator()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.plot_model(generator, show_shapes<span class="op">=</span><span class="va">True</span>, dpi<span class="op">=</span><span class="dv">64</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="55bb1e00-478b-49eb-b479-edb7de4effdf" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>LAMBDA <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>loss_object <span class="op">=</span> tf.keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generator_loss(disc_generated_output, gen_output, target):</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    gan_loss <span class="op">=</span> loss_object(tf.ones_like(disc_generated_output), disc_generated_output)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean absolute error</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    l1_loss <span class="op">=</span> tf.reduce_mean(tf.<span class="bu">abs</span>(target <span class="op">-</span> gen_output))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    total_gen_loss <span class="op">=</span> gan_loss <span class="op">+</span> (LAMBDA <span class="op">*</span> l1_loss)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_gen_loss, gan_loss, l1_loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="border-left: 4px solid #f00; padding: 0.5em; background-color: #fdd; margin-top:0.5em; margin-bottom: 0.5em;">
<p><strong>Please refer to:</strong> <br> <a href="https://resources.experfy.com/ai-ml/learning-ai-if-you-suck-at-math-part4-tensors-illustrated-with-cats/">Learning AI If You Suck at Math Part 4 - Tensor Illustrated With Cats</a> and <a href="https://resources.experfy.com/ai-ml/learning-ai-if-you-suck-at-math-part5-deep-learning-and-convolutional-neural-nets-in-plain-english/">Part 5 - Deep Learning and Convolutional Neural Nets in Plain English by Daniel Jeffries</a> for more knowledge on convolutional layers.</p>
</div>
</section>
<section id="step-4" class="level2">
<h2 class="anchored" data-anchor-id="step-4">Step 4</h2>
<p><strong style="color: #CD6AA3;">Then, we build another major component of GAN model – discriminator.</strong> This function enables the model downsamples the input image (a concatenation of land cover and satellite image in 2 channels) and predicts whether the generated image is real or fake. Likewise, the tf.keras.utils.plot_model(discriminator, show_shapes=True, dpi=64) command can be used to examine the structure of this discriminator and discriminator_loss() function can record the performance of discriminator during each iteration of training.</p>
<div id="7ff1107c-56b9-429d-ae93-6a3e8ef74050" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Discriminator():</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  initializer <span class="op">=</span> tf.random_normal_initializer(<span class="fl">0.</span>, <span class="fl">0.02</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  inp <span class="op">=</span> tf.keras.layers.Input(shape<span class="op">=</span>[<span class="dv">256</span>, <span class="dv">256</span>, <span class="dv">3</span>], name<span class="op">=</span><span class="st">'input_image'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  tar <span class="op">=</span> tf.keras.layers.Input(shape<span class="op">=</span>[<span class="dv">256</span>, <span class="dv">256</span>, <span class="dv">3</span>], name<span class="op">=</span><span class="st">'target_image'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> tf.keras.layers.concatenate([inp, tar])  <span class="co"># (batch_size, 256, 256, channels*2)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  down1 <span class="op">=</span> downsample(<span class="dv">64</span>, <span class="dv">4</span>, <span class="va">False</span>)(x)  <span class="co"># (batch_size, 128, 128, 64)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  down2 <span class="op">=</span> downsample(<span class="dv">128</span>, <span class="dv">4</span>)(down1)  <span class="co"># (batch_size, 64, 64, 128)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  down3 <span class="op">=</span> downsample(<span class="dv">256</span>, <span class="dv">4</span>)(down2)  <span class="co"># (batch_size, 32, 32, 256)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  zero_pad1 <span class="op">=</span> tf.keras.layers.ZeroPadding2D()(down3)  <span class="co"># (batch_size, 34, 34, 256)</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  conv <span class="op">=</span> tf.keras.layers.Conv2D(<span class="dv">512</span>, <span class="dv">4</span>, strides<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                                kernel_initializer<span class="op">=</span>initializer,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                                use_bias<span class="op">=</span><span class="va">False</span>)(zero_pad1)  <span class="co"># (batch_size, 31, 31, 512)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  batchnorm1 <span class="op">=</span> tf.keras.layers.BatchNormalization()(conv)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  leaky_relu <span class="op">=</span> tf.keras.layers.LeakyReLU()(batchnorm1)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  zero_pad2 <span class="op">=</span> tf.keras.layers.ZeroPadding2D()(leaky_relu)  <span class="co"># (batch_size, 33, 33, 512)</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  last <span class="op">=</span> tf.keras.layers.Conv2D(<span class="dv">1</span>, <span class="dv">4</span>, strides<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                                kernel_initializer<span class="op">=</span>initializer)(zero_pad2)  <span class="co"># (batch_size, 30, 30, 1)</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> tf.keras.Model(inputs<span class="op">=</span>[inp, tar], outputs<span class="op">=</span>last)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="474919ff-a0c5-42fd-8283-ee6944796758" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>discriminator <span class="op">=</span> Discriminator()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.plot_model(discriminator, show_shapes<span class="op">=</span><span class="va">True</span>, dpi<span class="op">=</span><span class="dv">64</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="47111b0f-617e-4145-ac07-00047004fa76" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> discriminator_loss(disc_real_output, disc_generated_output):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    real_loss <span class="op">=</span> loss_object(tf.ones_like(disc_real_output), disc_real_output)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    generated_loss <span class="op">=</span> loss_object(tf.zeros_like(disc_generated_output), disc_generated_output)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    total_disc_loss <span class="op">=</span> real_loss <span class="op">+</span> generated_loss</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_disc_loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-5" class="level2">
<h2 class="anchored" data-anchor-id="step-5">Step 5</h2>
<p><strong style="color: #CD6AA3;">After this step, we add optimizer parameters</strong> (adjusting model’s learning rate) and training checkpoints to allow intervals in training. Training checkpoints are saved at checkpoint_dir.</p>
<div id="8136b370-77b4-453f-ab74-33460de18fea" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>generator_optimizer <span class="op">=</span> tf.keras.optimizers.Adam(<span class="fl">2e-4</span>, beta_1<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>discriminator_optimizer <span class="op">=</span> tf.keras.optimizers.Adam(<span class="fl">2e-4</span>, beta_1<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>checkpoint_dir <span class="op">=</span> <span class="st">'24-1204_Pix2Pix_3/training_checkpoints'</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>checkpoint_prefix <span class="op">=</span> os.path.join(checkpoint_dir, <span class="st">"ckpt"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>checkpoint <span class="op">=</span> tf.train.Checkpoint(generator_optimizer<span class="op">=</span>generator_optimizer,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                                 discriminator_optimizer<span class="op">=</span>discriminator_optimizer,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                                 generator<span class="op">=</span>generator,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                                 discriminator<span class="op">=</span>discriminator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-6" class="level2">
<h2 class="anchored" data-anchor-id="step-6">Step 6</h2>
<p><strong style="color: #CD6AA3;">Finally, we build a function that allows us to check the training progress over training iterations.</strong> This function will save original land cover and satellite images along with generated satellite images side by side for every image in test_dataset.</p>
<div id="fab7a60e-8d72-4c80-b6aa-2e70999ade85" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_images(model, test_input, tar, save_dir, prefix<span class="op">=</span><span class="st">'image'</span>, max_images<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    os.makedirs(save_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    test_input <span class="op">=</span> tf.squeeze(test_input, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    tar <span class="op">=</span> tf.squeeze(tar, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> model(test_input, training<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    num_images <span class="op">=</span> <span class="bu">min</span>(test_input.shape[<span class="dv">0</span>], max_images)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_images):</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        display_list <span class="op">=</span> [test_input[i], tar[i], predictions[i]]</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> [<span class="st">'Input Image'</span>, <span class="st">'Ground Truth'</span>, <span class="st">'Predicted Image'</span>]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>            plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, j<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>            plt.title(title[j])</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>            plt.imshow(display_list[j] <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>            plt.axis(<span class="st">'off'</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        image_path <span class="op">=</span> os.path.join(save_dir, <span class="ss">f'</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        plt.savefig(image_path)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-7" class="level2">
<h2 class="anchored" data-anchor-id="step-7">Step 7</h2>
<p><strong style="color: #CD6AA3;">After building the model, we use the model to train on our land cover and satellite data.</strong> For each 10 steps(training 10 BATCH_SIZE of images), the fit() function prints a dot; for each 1000 steps, the fit() function prints training time and generator/discriminator loss after each 1000 step, while images generated by the newest model are saved at save_dir; for each 5000 steps, the model saves at checkpoint folder.</p>
<div id="46ac82d4-d5b2-4f5b-8cb7-f94f1f1b728f" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>log_dir <span class="op">=</span> <span class="st">'24-1204_Pix2Pix_3/logs/'</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>summary_writer <span class="op">=</span> tf.summary.create_file_writer(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  log_dir <span class="op">+</span> <span class="st">"fit/"</span> <span class="op">+</span> datetime.datetime.now().strftime(<span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">-%H%M%S"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e7dd096d-ee78-4375-9afa-e24ae92bf0bf" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>gen_gan_loss_list <span class="op">=</span> []</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>gen_l1_loss_list <span class="op">=</span> []</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>gen_total_loss_list <span class="op">=</span> []</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>disc_loss_list <span class="op">=</span> []</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">@tf.function</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_step(input_image, target):</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> tf.GradientTape() <span class="im">as</span> gen_tape, tf.GradientTape() <span class="im">as</span> disc_tape:</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        gen_output <span class="op">=</span> generator(input_image, training<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        disc_real_output <span class="op">=</span> discriminator([input_image, target], training<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        disc_generated_output <span class="op">=</span> discriminator([input_image, gen_output], training<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        gen_total_loss, gen_gan_loss, gen_l1_loss <span class="op">=</span> generator_loss(</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>            disc_generated_output, gen_output, target)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        disc_loss <span class="op">=</span> discriminator_loss(disc_real_output, disc_generated_output)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    generator_gradients <span class="op">=</span> gen_tape.gradient(gen_total_loss, generator.trainable_variables)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    discriminator_gradients <span class="op">=</span> disc_tape.gradient(disc_loss, discriminator.trainable_variables)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    generator_optimizer.apply_gradients(<span class="bu">zip</span>(generator_gradients, generator.trainable_variables))</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    discriminator_optimizer.apply_gradients(<span class="bu">zip</span>(discriminator_gradients, discriminator.trainable_variables))</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> summary_writer.as_default():</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        tf.summary.scalar(<span class="st">'gen_total_loss'</span>, gen_total_loss, step<span class="op">=</span>step)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        tf.summary.scalar(<span class="st">'gen_gan_loss'</span>, gen_gan_loss, step<span class="op">=</span>step)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        tf.summary.scalar(<span class="st">'gen_l1_loss'</span>, gen_l1_loss, step<span class="op">=</span>step)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        tf.summary.scalar(<span class="st">'disc_loss'</span>, disc_loss, step<span class="op">=</span>step)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gen_total_loss, gen_gan_loss, gen_l1_loss, disc_loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="167008dc-4f04-49fe-9fb2-e4a63057b270" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit(train_ds, test_ds, steps):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> builtins <span class="im">import</span> <span class="bu">enumerate</span>  </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    example_input, example_target <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(test_ds.batch(<span class="dv">45</span>).take(<span class="dv">1</span>)))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.time()</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step, (input_image, target) <span class="kw">in</span> <span class="bu">enumerate</span>(train_ds.repeat().take(steps)):</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        gen_total_loss, gen_gan_loss, gen_l1_loss, disc_loss <span class="op">=</span> train_step(input_image, target)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> step <span class="op">%</span> <span class="dv">1000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> step <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">Time taken for 1000 steps: </span><span class="sc">{</span>time<span class="sc">.</span>time() <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss"> sec</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Print the losses</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'Discriminator loss:'</span>, disc_loss.numpy())</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'Generator GAN loss:'</span>, gen_gan_loss.numpy())</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'Generator L1 loss:'</span>, gen_l1_loss.numpy())</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'Generator total loss:'</span>, gen_total_loss.numpy())</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>            start <span class="op">=</span> time.time()</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>            save_dir <span class="op">=</span> <span class="st">'./24-1204_Pix2Pix_3/generated_images'</span> </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>            generate_images(generator, example_input, example_target, save_dir, prefix<span class="op">=</span><span class="ss">f'step_</span><span class="sc">{</span>step<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Step: </span><span class="sc">{</span>step <span class="op">//</span> <span class="dv">1000</span><span class="sc">}</span><span class="ss">k"</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (step <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'.'</span>, end<span class="op">=</span><span class="st">''</span>, flush<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (step <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">5000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>                checkpoint.save(file_prefix<span class="op">=</span>checkpoint_prefix)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">UnicodeDecodeError</span> <span class="im">as</span> e:</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Checkpoint save error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">#with summary_writer.as_default():</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>            <span class="co">#tf.summary.scalar('gen_total_loss', gen_total_loss, step=step)</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">#tf.summary.scalar('gen_gan_loss', gen_gan_loss, step=step)</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>            <span class="co">#tf.summary.scalar('gen_l1_loss', gen_l1_loss, step=step)</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>            <span class="co">#tf.summary.scalar('disc_loss', disc_loss, step=step)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1808ab2b-378f-4c0f-b040-445837ced349" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fit(train_dataset, test_dataset, steps<span class="op">=</span><span class="dv">40000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong style="color: #CD6AA3;">We can also check generated images</strong> by the final model and save the final model by running following commands:</p>
<div id="9552a7fe-a828-4ff1-b027-eff40798a0be" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>generation_files <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(<span class="st">'24-1204_Pix2Pix_3/generated_images'</span>) <span class="cf">if</span> <span class="bu">file</span>.endswith((<span class="st">'.png'</span>, <span class="st">'.jpg'</span>, <span class="st">'.jpeg'</span>)) <span class="kw">and</span> <span class="bu">file</span>.startswith(<span class="st">'step_39000'</span>)]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, filename <span class="kw">in</span> <span class="bu">enumerate</span>(generation_files[:<span class="dv">5</span>]):</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    img_path <span class="op">=</span> os.path.join(<span class="st">'./24-1204_Pix2Pix_3/generated_images'</span>, filename)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(img_path)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>)) </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    ax.imshow(img)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">'off'</span>) </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-23-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-23-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="4-1_files/figure-html/cell-23-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="dd7b589f-bf08-4538-9b73-5bc13ed32fff" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>generator.save(<span class="st">'./24-1204_Pix2Pix_3/model.h5'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong style="color: #CD6AA3;">The following graphs show the running time and model performance from one of my training session.</strong> As Model Performance Metrics graph shows, the Generator L1 Loss, or the pixel-wise absolute difference between the generated image and the ground-truth image, stables at a lower level, inidcating that trained images have high resemblance to their ground truth images; generator GAN loss and discriminator loss fluctuates at a higher level, reflecting the adversarial nature of the training process, where the generator and discriminator continually compete. This competition leads to fluctuations as the generator tries to fool the discriminator, and the discriminator strives to distinguish real images from generated ones.</p>
<p>The Training Time graph shows that each 1,000 step in training takes about 125 seconds, regardless of the progression of the training. In total, a 39,000-step training session with 1,000 images would generally take 81 minutes to complete.</p>
<div id="73dd791a-2ab8-47fc-bb41-6c9f82b2bd34" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Step"</span>: [],</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Time"</span>: [],</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Discriminator Loss"</span>: [],</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Generator GAN Loss"</span>: [],</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Generator L1 Loss"</span>: [],</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Generator Total Loss"</span>: []</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'24-1204_Pix2Pix_3/logs/logs.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> <span class="bu">file</span>.readlines()</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(lines), <span class="dv">8</span>):</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        step_line <span class="op">=</span> lines[i].strip()</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        time_line <span class="op">=</span> lines[i <span class="op">+</span> <span class="dv">2</span>].strip()</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        disc_loss_line <span class="op">=</span> lines[i <span class="op">+</span> <span class="dv">4</span>].strip()</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        gen_gan_loss_line <span class="op">=</span> lines[i <span class="op">+</span> <span class="dv">5</span>].strip()</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        gen_l1_loss_line <span class="op">=</span> lines[i <span class="op">+</span> <span class="dv">6</span>].strip()</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        gen_total_loss_line <span class="op">=</span> lines[i <span class="op">+</span> <span class="dv">7</span>].strip()</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        step <span class="op">=</span> <span class="bu">int</span>(step_line.split(<span class="st">':'</span>)[<span class="dv">1</span>].replace(<span class="st">'k'</span>, <span class="st">'000'</span>))</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        time <span class="op">=</span> <span class="bu">float</span>(time_line.split(<span class="st">': '</span>)[<span class="dv">1</span>].split()[<span class="dv">0</span>])</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        disc_loss <span class="op">=</span> <span class="bu">float</span>(disc_loss_line.split(<span class="st">': '</span>)[<span class="dv">1</span>])</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        gen_gan_loss <span class="op">=</span> <span class="bu">float</span>(gen_gan_loss_line.split(<span class="st">': '</span>)[<span class="dv">1</span>])</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        gen_l1_loss <span class="op">=</span> <span class="bu">float</span>(gen_l1_loss_line.split(<span class="st">': '</span>)[<span class="dv">1</span>])</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        gen_total_loss <span class="op">=</span> <span class="bu">float</span>(gen_total_loss_line.split(<span class="st">': '</span>)[<span class="dv">1</span>])</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Step"</span>].append(step)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Time"</span>].append(time)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Discriminator Loss"</span>].append(disc_loss)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Generator GAN Loss"</span>].append(gen_gan_loss)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Generator L1 Loss"</span>].append(gen_l1_loss)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Generator Total Loss"</span>].append(gen_total_loss)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>chart1 <span class="op">=</span> alt.Chart(df).mark_line(point<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'Step'</span>, title<span class="op">=</span><span class="st">'Training Step'</span>),</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Time'</span>, title<span class="op">=</span><span class="st">'Time Taken (sec)'</span>),</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'Step'</span>, <span class="st">'Time'</span>]</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Training Time Per 1,000 Steps'</span>,</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">900</span>,  </span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">450</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>chart2 <span class="op">=</span> alt.Chart(df.melt(<span class="st">'Step'</span>, var_name<span class="op">=</span><span class="st">'Metric'</span>, value_name<span class="op">=</span><span class="st">'Value'</span>)).transform_filter(</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    alt.datum.Metric <span class="op">!=</span> <span class="st">'Time'</span> </span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>).transform_filter(</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    alt.datum.Metric <span class="op">!=</span> <span class="st">'Generator Total Loss'</span> </span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>).mark_line(point<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'Step'</span>, title<span class="op">=</span><span class="st">'Training Step'</span>),</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Value'</span>, title<span class="op">=</span><span class="st">'Loss Values'</span>),</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'Metric'</span>,</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'Step'</span>, <span class="st">'Metric'</span>, <span class="st">'Value'</span>]</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Model Performance Metrics'</span>,</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">900</span>,  </span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">450</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>chart2 <span class="op">&amp;</span> chart1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">

<style>
  #altair-viz-e28d041fd6164534a79b2d3b0813112a.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-e28d041fd6164534a79b2d3b0813112a.vega-embed details,
  #altair-viz-e28d041fd6164534a79b2d3b0813112a.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-e28d041fd6164534a79b2d3b0813112a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e28d041fd6164534a79b2d3b0813112a") {
      outputDiv = document.getElementById("altair-viz-e28d041fd6164534a79b2d3b0813112a");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "vconcat": [{"data": {"name": "data-785aa3fc0431b3e7b2db73636728bc1c"}, "mark": {"type": "line", "point": true}, "encoding": {"color": {"field": "Metric", "type": "nominal"}, "tooltip": [{"field": "Step", "type": "quantitative"}, {"field": "Metric", "type": "nominal"}, {"field": "Value", "type": "quantitative"}], "x": {"field": "Step", "title": "Training Step", "type": "quantitative"}, "y": {"field": "Value", "title": "Loss Values", "type": "quantitative"}}, "height": 450, "title": "Model Performance Metrics", "transform": [{"filter": "(datum.Metric !== 'Time')"}, {"filter": "(datum.Metric !== 'Generator Total Loss')"}], "width": 900}, {"data": {"name": "data-f68e59185081920572cded7b1dd7e455"}, "mark": {"type": "line", "point": true}, "encoding": {"tooltip": [{"field": "Step", "type": "quantitative"}, {"field": "Time", "type": "quantitative"}], "x": {"field": "Step", "title": "Training Step", "type": "quantitative"}, "y": {"field": "Time", "title": "Time Taken (sec)", "type": "quantitative"}}, "height": 450, "title": "Training Time Per 1,000 Steps", "width": 900}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-785aa3fc0431b3e7b2db73636728bc1c": [{"Step": 0, "Metric": "Time", "Value": 107.82}, {"Step": 1000, "Metric": "Time", "Value": 124.55}, {"Step": 2000, "Metric": "Time", "Value": 131.08}, {"Step": 3000, "Metric": "Time", "Value": 141.42}, {"Step": 4000, "Metric": "Time", "Value": 128.49}, {"Step": 5000, "Metric": "Time", "Value": 124.29}, {"Step": 6000, "Metric": "Time", "Value": 127.37}, {"Step": 7000, "Metric": "Time", "Value": 131.48}, {"Step": 8000, "Metric": "Time", "Value": 130.76}, {"Step": 9000, "Metric": "Time", "Value": 139.18}, {"Step": 10000, "Metric": "Time", "Value": 133.76}, {"Step": 11000, "Metric": "Time", "Value": 140.85}, {"Step": 12000, "Metric": "Time", "Value": 136.55}, {"Step": 13000, "Metric": "Time", "Value": 138.0}, {"Step": 14000, "Metric": "Time", "Value": 131.68}, {"Step": 15000, "Metric": "Time", "Value": 134.34}, {"Step": 16000, "Metric": "Time", "Value": 134.02}, {"Step": 17000, "Metric": "Time", "Value": 129.39}, {"Step": 18000, "Metric": "Time", "Value": 128.43}, {"Step": 19000, "Metric": "Time", "Value": 130.18}, {"Step": 20000, "Metric": "Time", "Value": 122.52}, {"Step": 21000, "Metric": "Time", "Value": 122.7}, {"Step": 22000, "Metric": "Time", "Value": 123.1}, {"Step": 23000, "Metric": "Time", "Value": 129.04}, {"Step": 24000, "Metric": "Time", "Value": 123.83}, {"Step": 25000, "Metric": "Time", "Value": 119.05}, {"Step": 26000, "Metric": "Time", "Value": 119.7}, {"Step": 27000, "Metric": "Time", "Value": 125.02}, {"Step": 28000, "Metric": "Time", "Value": 120.63}, {"Step": 29000, "Metric": "Time", "Value": 123.41}, {"Step": 30000, "Metric": "Time", "Value": 119.92}, {"Step": 31000, "Metric": "Time", "Value": 125.31}, {"Step": 32000, "Metric": "Time", "Value": 120.82}, {"Step": 33000, "Metric": "Time", "Value": 123.93}, {"Step": 34000, "Metric": "Time", "Value": 125.07}, {"Step": 35000, "Metric": "Time", "Value": 127.29}, {"Step": 36000, "Metric": "Time", "Value": 121.27}, {"Step": 37000, "Metric": "Time", "Value": 121.26}, {"Step": 38000, "Metric": "Time", "Value": 122.16}, {"Step": 0, "Metric": "Discriminator Loss", "Value": 0.73785996}, {"Step": 1000, "Metric": "Discriminator Loss", "Value": 0.9131502}, {"Step": 2000, "Metric": "Discriminator Loss", "Value": 0.8220801}, {"Step": 3000, "Metric": "Discriminator Loss", "Value": 0.80408436}, {"Step": 4000, "Metric": "Discriminator Loss", "Value": 1.2985153}, {"Step": 5000, "Metric": "Discriminator Loss", "Value": 0.9618423}, {"Step": 6000, "Metric": "Discriminator Loss", "Value": 1.1550436}, {"Step": 7000, "Metric": "Discriminator Loss", "Value": 1.210499}, {"Step": 8000, "Metric": "Discriminator Loss", "Value": 2.3258278}, {"Step": 9000, "Metric": "Discriminator Loss", "Value": 0.6828687}, {"Step": 10000, "Metric": "Discriminator Loss", "Value": 1.0476885}, {"Step": 11000, "Metric": "Discriminator Loss", "Value": 0.4143842}, {"Step": 12000, "Metric": "Discriminator Loss", "Value": 0.7155479}, {"Step": 13000, "Metric": "Discriminator Loss", "Value": 2.0680387}, {"Step": 14000, "Metric": "Discriminator Loss", "Value": 0.5718351}, {"Step": 15000, "Metric": "Discriminator Loss", "Value": 0.97906065}, {"Step": 16000, "Metric": "Discriminator Loss", "Value": 1.0966283}, {"Step": 17000, "Metric": "Discriminator Loss", "Value": 0.7646351}, {"Step": 18000, "Metric": "Discriminator Loss", "Value": 0.58186996}, {"Step": 19000, "Metric": "Discriminator Loss", "Value": 1.0673251}, {"Step": 20000, "Metric": "Discriminator Loss", "Value": 0.71678114}, {"Step": 21000, "Metric": "Discriminator Loss", "Value": 0.52016366}, {"Step": 22000, "Metric": "Discriminator Loss", "Value": 0.7037725}, {"Step": 23000, "Metric": "Discriminator Loss", "Value": 0.47234833}, {"Step": 24000, "Metric": "Discriminator Loss", "Value": 0.862738}, {"Step": 25000, "Metric": "Discriminator Loss", "Value": 1.007914}, {"Step": 26000, "Metric": "Discriminator Loss", "Value": 0.8027315}, {"Step": 27000, "Metric": "Discriminator Loss", "Value": 0.6391425}, {"Step": 28000, "Metric": "Discriminator Loss", "Value": 0.8917093}, {"Step": 29000, "Metric": "Discriminator Loss", "Value": 0.3475626}, {"Step": 30000, "Metric": "Discriminator Loss", "Value": 0.8769059}, {"Step": 31000, "Metric": "Discriminator Loss", "Value": 0.91161543}, {"Step": 32000, "Metric": "Discriminator Loss", "Value": 1.1193655}, {"Step": 33000, "Metric": "Discriminator Loss", "Value": 0.5263567}, {"Step": 34000, "Metric": "Discriminator Loss", "Value": 0.6807474}, {"Step": 35000, "Metric": "Discriminator Loss", "Value": 1.1518384}, {"Step": 36000, "Metric": "Discriminator Loss", "Value": 0.7576015}, {"Step": 37000, "Metric": "Discriminator Loss", "Value": 0.68960524}, {"Step": 38000, "Metric": "Discriminator Loss", "Value": 1.8272173}, {"Step": 0, "Metric": "Generator GAN Loss", "Value": 1.6827435}, {"Step": 1000, "Metric": "Generator GAN Loss", "Value": 2.3831928}, {"Step": 2000, "Metric": "Generator GAN Loss", "Value": 1.7979214}, {"Step": 3000, "Metric": "Generator GAN Loss", "Value": 1.4009151}, {"Step": 4000, "Metric": "Generator GAN Loss", "Value": 2.0910847}, {"Step": 5000, "Metric": "Generator GAN Loss", "Value": 2.5089028}, {"Step": 6000, "Metric": "Generator GAN Loss", "Value": 1.3715938}, {"Step": 7000, "Metric": "Generator GAN Loss", "Value": 1.5684477}, {"Step": 8000, "Metric": "Generator GAN Loss", "Value": 0.31807864}, {"Step": 9000, "Metric": "Generator GAN Loss", "Value": 3.4728606}, {"Step": 10000, "Metric": "Generator GAN Loss", "Value": 0.9531807}, {"Step": 11000, "Metric": "Generator GAN Loss", "Value": 1.6604979}, {"Step": 12000, "Metric": "Generator GAN Loss", "Value": 1.0019411}, {"Step": 13000, "Metric": "Generator GAN Loss", "Value": 1.4771026}, {"Step": 14000, "Metric": "Generator GAN Loss", "Value": 1.348474}, {"Step": 15000, "Metric": "Generator GAN Loss", "Value": 2.2240663}, {"Step": 16000, "Metric": "Generator GAN Loss", "Value": 1.2288915}, {"Step": 17000, "Metric": "Generator GAN Loss", "Value": 1.2485842}, {"Step": 18000, "Metric": "Generator GAN Loss", "Value": 1.6756177}, {"Step": 19000, "Metric": "Generator GAN Loss", "Value": 1.1097726}, {"Step": 20000, "Metric": "Generator GAN Loss", "Value": 1.2201451}, {"Step": 21000, "Metric": "Generator GAN Loss", "Value": 1.4203696}, {"Step": 22000, "Metric": "Generator GAN Loss", "Value": 0.94850343}, {"Step": 23000, "Metric": "Generator GAN Loss", "Value": 2.2978988}, {"Step": 24000, "Metric": "Generator GAN Loss", "Value": 1.3025906}, {"Step": 25000, "Metric": "Generator GAN Loss", "Value": 1.9340929}, {"Step": 26000, "Metric": "Generator GAN Loss", "Value": 0.9831961}, {"Step": 27000, "Metric": "Generator GAN Loss", "Value": 1.1850067}, {"Step": 28000, "Metric": "Generator GAN Loss", "Value": 0.7271487}, {"Step": 29000, "Metric": "Generator GAN Loss", "Value": 2.0592256}, {"Step": 30000, "Metric": "Generator GAN Loss", "Value": 0.97645944}, {"Step": 31000, "Metric": "Generator GAN Loss", "Value": 0.95088524}, {"Step": 32000, "Metric": "Generator GAN Loss", "Value": 2.3838468}, {"Step": 33000, "Metric": "Generator GAN Loss", "Value": 1.7964365}, {"Step": 34000, "Metric": "Generator GAN Loss", "Value": 1.8112556}, {"Step": 35000, "Metric": "Generator GAN Loss", "Value": 1.5345688}, {"Step": 36000, "Metric": "Generator GAN Loss", "Value": 1.7003558}, {"Step": 37000, "Metric": "Generator GAN Loss", "Value": 1.3168797}, {"Step": 38000, "Metric": "Generator GAN Loss", "Value": 3.391673}, {"Step": 0, "Metric": "Generator L1 Loss", "Value": 0.115415335}, {"Step": 1000, "Metric": "Generator L1 Loss", "Value": 0.14474587}, {"Step": 2000, "Metric": "Generator L1 Loss", "Value": 0.11110628}, {"Step": 3000, "Metric": "Generator L1 Loss", "Value": 0.103600025}, {"Step": 4000, "Metric": "Generator L1 Loss", "Value": 0.104951896}, {"Step": 5000, "Metric": "Generator L1 Loss", "Value": 0.12463225}, {"Step": 6000, "Metric": "Generator L1 Loss", "Value": 0.046257038}, {"Step": 7000, "Metric": "Generator L1 Loss", "Value": 0.09927561}, {"Step": 8000, "Metric": "Generator L1 Loss", "Value": 0.10767888}, {"Step": 9000, "Metric": "Generator L1 Loss", "Value": 0.15414473}, {"Step": 10000, "Metric": "Generator L1 Loss", "Value": 0.10970064}, {"Step": 11000, "Metric": "Generator L1 Loss", "Value": 0.13292164}, {"Step": 12000, "Metric": "Generator L1 Loss", "Value": 0.13624507}, {"Step": 13000, "Metric": "Generator L1 Loss", "Value": 0.0860255}, {"Step": 14000, "Metric": "Generator L1 Loss", "Value": 0.118947364}, {"Step": 15000, "Metric": "Generator L1 Loss", "Value": 0.16737716}, {"Step": 16000, "Metric": "Generator L1 Loss", "Value": 0.10345616}, {"Step": 17000, "Metric": "Generator L1 Loss", "Value": 0.104555726}, {"Step": 18000, "Metric": "Generator L1 Loss", "Value": 0.12033676}, {"Step": 19000, "Metric": "Generator L1 Loss", "Value": 0.111096345}, {"Step": 20000, "Metric": "Generator L1 Loss", "Value": 0.09986246}, {"Step": 21000, "Metric": "Generator L1 Loss", "Value": 0.12042054}, {"Step": 22000, "Metric": "Generator L1 Loss", "Value": 0.11976495}, {"Step": 23000, "Metric": "Generator L1 Loss", "Value": 0.13748483}, {"Step": 24000, "Metric": "Generator L1 Loss", "Value": 0.10993848}, {"Step": 25000, "Metric": "Generator L1 Loss", "Value": 0.14211303}, {"Step": 26000, "Metric": "Generator L1 Loss", "Value": 0.05976628}, {"Step": 27000, "Metric": "Generator L1 Loss", "Value": 0.093435526}, {"Step": 28000, "Metric": "Generator L1 Loss", "Value": 0.12314681}, {"Step": 29000, "Metric": "Generator L1 Loss", "Value": 0.10655404}, {"Step": 30000, "Metric": "Generator L1 Loss", "Value": 0.11912745}, {"Step": 31000, "Metric": "Generator L1 Loss", "Value": 0.11328872}, {"Step": 32000, "Metric": "Generator L1 Loss", "Value": 0.11166652}, {"Step": 33000, "Metric": "Generator L1 Loss", "Value": 0.06297319}, {"Step": 34000, "Metric": "Generator L1 Loss", "Value": 0.07314285}, {"Step": 35000, "Metric": "Generator L1 Loss", "Value": 0.08515694}, {"Step": 36000, "Metric": "Generator L1 Loss", "Value": 0.09748752}, {"Step": 37000, "Metric": "Generator L1 Loss", "Value": 0.08719856}, {"Step": 38000, "Metric": "Generator L1 Loss", "Value": 0.08450085}, {"Step": 0, "Metric": "Generator Total Loss", "Value": 13.2242775}, {"Step": 1000, "Metric": "Generator Total Loss", "Value": 16.85778}, {"Step": 2000, "Metric": "Generator Total Loss", "Value": 12.908549}, {"Step": 3000, "Metric": "Generator Total Loss", "Value": 11.760918}, {"Step": 4000, "Metric": "Generator Total Loss", "Value": 12.586274}, {"Step": 5000, "Metric": "Generator Total Loss", "Value": 14.972127}, {"Step": 6000, "Metric": "Generator Total Loss", "Value": 5.997298}, {"Step": 7000, "Metric": "Generator Total Loss", "Value": 11.496009}, {"Step": 8000, "Metric": "Generator Total Loss", "Value": 11.085967}, {"Step": 9000, "Metric": "Generator Total Loss", "Value": 18.887335}, {"Step": 10000, "Metric": "Generator Total Loss", "Value": 11.923244}, {"Step": 11000, "Metric": "Generator Total Loss", "Value": 14.9526615}, {"Step": 12000, "Metric": "Generator Total Loss", "Value": 14.626448}, {"Step": 13000, "Metric": "Generator Total Loss", "Value": 10.079652}, {"Step": 14000, "Metric": "Generator Total Loss", "Value": 13.24321}, {"Step": 15000, "Metric": "Generator Total Loss", "Value": 18.961782}, {"Step": 16000, "Metric": "Generator Total Loss", "Value": 11.574508}, {"Step": 17000, "Metric": "Generator Total Loss", "Value": 11.704156}, {"Step": 18000, "Metric": "Generator Total Loss", "Value": 13.709293}, {"Step": 19000, "Metric": "Generator Total Loss", "Value": 12.219407}, {"Step": 20000, "Metric": "Generator Total Loss", "Value": 11.206391}, {"Step": 21000, "Metric": "Generator Total Loss", "Value": 13.462423}, {"Step": 22000, "Metric": "Generator Total Loss", "Value": 12.924998}, {"Step": 23000, "Metric": "Generator Total Loss", "Value": 16.046383}, {"Step": 24000, "Metric": "Generator Total Loss", "Value": 12.296438}, {"Step": 25000, "Metric": "Generator Total Loss", "Value": 16.145395}, {"Step": 26000, "Metric": "Generator Total Loss", "Value": 6.9598246}, {"Step": 27000, "Metric": "Generator Total Loss", "Value": 10.52856}, {"Step": 28000, "Metric": "Generator Total Loss", "Value": 13.04183}, {"Step": 29000, "Metric": "Generator Total Loss", "Value": 12.71463}, {"Step": 30000, "Metric": "Generator Total Loss", "Value": 12.889205}, {"Step": 31000, "Metric": "Generator Total Loss", "Value": 12.2797575}, {"Step": 32000, "Metric": "Generator Total Loss", "Value": 13.550499}, {"Step": 33000, "Metric": "Generator Total Loss", "Value": 8.093755}, {"Step": 34000, "Metric": "Generator Total Loss", "Value": 9.125541}, {"Step": 35000, "Metric": "Generator Total Loss", "Value": 10.050262}, {"Step": 36000, "Metric": "Generator Total Loss", "Value": 11.449107}, {"Step": 37000, "Metric": "Generator Total Loss", "Value": 10.036736}, {"Step": 38000, "Metric": "Generator Total Loss", "Value": 11.841758}], "data-f68e59185081920572cded7b1dd7e455": [{"Step": 0, "Time": 107.82, "Discriminator Loss": 0.73785996, "Generator GAN Loss": 1.6827435, "Generator L1 Loss": 0.115415335, "Generator Total Loss": 13.2242775}, {"Step": 1000, "Time": 124.55, "Discriminator Loss": 0.9131502, "Generator GAN Loss": 2.3831928, "Generator L1 Loss": 0.14474587, "Generator Total Loss": 16.85778}, {"Step": 2000, "Time": 131.08, "Discriminator Loss": 0.8220801, "Generator GAN Loss": 1.7979214, "Generator L1 Loss": 0.11110628, "Generator Total Loss": 12.908549}, {"Step": 3000, "Time": 141.42, "Discriminator Loss": 0.80408436, "Generator GAN Loss": 1.4009151, "Generator L1 Loss": 0.103600025, "Generator Total Loss": 11.760918}, {"Step": 4000, "Time": 128.49, "Discriminator Loss": 1.2985153, "Generator GAN Loss": 2.0910847, "Generator L1 Loss": 0.104951896, "Generator Total Loss": 12.586274}, {"Step": 5000, "Time": 124.29, "Discriminator Loss": 0.9618423, "Generator GAN Loss": 2.5089028, "Generator L1 Loss": 0.12463225, "Generator Total Loss": 14.972127}, {"Step": 6000, "Time": 127.37, "Discriminator Loss": 1.1550436, "Generator GAN Loss": 1.3715938, "Generator L1 Loss": 0.046257038, "Generator Total Loss": 5.997298}, {"Step": 7000, "Time": 131.48, "Discriminator Loss": 1.210499, "Generator GAN Loss": 1.5684477, "Generator L1 Loss": 0.09927561, "Generator Total Loss": 11.496009}, {"Step": 8000, "Time": 130.76, "Discriminator Loss": 2.3258278, "Generator GAN Loss": 0.31807864, "Generator L1 Loss": 0.10767888, "Generator Total Loss": 11.085967}, {"Step": 9000, "Time": 139.18, "Discriminator Loss": 0.6828687, "Generator GAN Loss": 3.4728606, "Generator L1 Loss": 0.15414473, "Generator Total Loss": 18.887335}, {"Step": 10000, "Time": 133.76, "Discriminator Loss": 1.0476885, "Generator GAN Loss": 0.9531807, "Generator L1 Loss": 0.10970064, "Generator Total Loss": 11.923244}, {"Step": 11000, "Time": 140.85, "Discriminator Loss": 0.4143842, "Generator GAN Loss": 1.6604979, "Generator L1 Loss": 0.13292164, "Generator Total Loss": 14.9526615}, {"Step": 12000, "Time": 136.55, "Discriminator Loss": 0.7155479, "Generator GAN Loss": 1.0019411, "Generator L1 Loss": 0.13624507, "Generator Total Loss": 14.626448}, {"Step": 13000, "Time": 138.0, "Discriminator Loss": 2.0680387, "Generator GAN Loss": 1.4771026, "Generator L1 Loss": 0.0860255, "Generator Total Loss": 10.079652}, {"Step": 14000, "Time": 131.68, "Discriminator Loss": 0.5718351, "Generator GAN Loss": 1.348474, "Generator L1 Loss": 0.118947364, "Generator Total Loss": 13.24321}, {"Step": 15000, "Time": 134.34, "Discriminator Loss": 0.97906065, "Generator GAN Loss": 2.2240663, "Generator L1 Loss": 0.16737716, "Generator Total Loss": 18.961782}, {"Step": 16000, "Time": 134.02, "Discriminator Loss": 1.0966283, "Generator GAN Loss": 1.2288915, "Generator L1 Loss": 0.10345616, "Generator Total Loss": 11.574508}, {"Step": 17000, "Time": 129.39, "Discriminator Loss": 0.7646351, "Generator GAN Loss": 1.2485842, "Generator L1 Loss": 0.104555726, "Generator Total Loss": 11.704156}, {"Step": 18000, "Time": 128.43, "Discriminator Loss": 0.58186996, "Generator GAN Loss": 1.6756177, "Generator L1 Loss": 0.12033676, "Generator Total Loss": 13.709293}, {"Step": 19000, "Time": 130.18, "Discriminator Loss": 1.0673251, "Generator GAN Loss": 1.1097726, "Generator L1 Loss": 0.111096345, "Generator Total Loss": 12.219407}, {"Step": 20000, "Time": 122.52, "Discriminator Loss": 0.71678114, "Generator GAN Loss": 1.2201451, "Generator L1 Loss": 0.09986246, "Generator Total Loss": 11.206391}, {"Step": 21000, "Time": 122.7, "Discriminator Loss": 0.52016366, "Generator GAN Loss": 1.4203696, "Generator L1 Loss": 0.12042054, "Generator Total Loss": 13.462423}, {"Step": 22000, "Time": 123.1, "Discriminator Loss": 0.7037725, "Generator GAN Loss": 0.94850343, "Generator L1 Loss": 0.11976495, "Generator Total Loss": 12.924998}, {"Step": 23000, "Time": 129.04, "Discriminator Loss": 0.47234833, "Generator GAN Loss": 2.2978988, "Generator L1 Loss": 0.13748483, "Generator Total Loss": 16.046383}, {"Step": 24000, "Time": 123.83, "Discriminator Loss": 0.862738, "Generator GAN Loss": 1.3025906, "Generator L1 Loss": 0.10993848, "Generator Total Loss": 12.296438}, {"Step": 25000, "Time": 119.05, "Discriminator Loss": 1.007914, "Generator GAN Loss": 1.9340929, "Generator L1 Loss": 0.14211303, "Generator Total Loss": 16.145395}, {"Step": 26000, "Time": 119.7, "Discriminator Loss": 0.8027315, "Generator GAN Loss": 0.9831961, "Generator L1 Loss": 0.05976628, "Generator Total Loss": 6.9598246}, {"Step": 27000, "Time": 125.02, "Discriminator Loss": 0.6391425, "Generator GAN Loss": 1.1850067, "Generator L1 Loss": 0.093435526, "Generator Total Loss": 10.52856}, {"Step": 28000, "Time": 120.63, "Discriminator Loss": 0.8917093, "Generator GAN Loss": 0.7271487, "Generator L1 Loss": 0.12314681, "Generator Total Loss": 13.04183}, {"Step": 29000, "Time": 123.41, "Discriminator Loss": 0.3475626, "Generator GAN Loss": 2.0592256, "Generator L1 Loss": 0.10655404, "Generator Total Loss": 12.71463}, {"Step": 30000, "Time": 119.92, "Discriminator Loss": 0.8769059, "Generator GAN Loss": 0.97645944, "Generator L1 Loss": 0.11912745, "Generator Total Loss": 12.889205}, {"Step": 31000, "Time": 125.31, "Discriminator Loss": 0.91161543, "Generator GAN Loss": 0.95088524, "Generator L1 Loss": 0.11328872, "Generator Total Loss": 12.2797575}, {"Step": 32000, "Time": 120.82, "Discriminator Loss": 1.1193655, "Generator GAN Loss": 2.3838468, "Generator L1 Loss": 0.11166652, "Generator Total Loss": 13.550499}, {"Step": 33000, "Time": 123.93, "Discriminator Loss": 0.5263567, "Generator GAN Loss": 1.7964365, "Generator L1 Loss": 0.06297319, "Generator Total Loss": 8.093755}, {"Step": 34000, "Time": 125.07, "Discriminator Loss": 0.6807474, "Generator GAN Loss": 1.8112556, "Generator L1 Loss": 0.07314285, "Generator Total Loss": 9.125541}, {"Step": 35000, "Time": 127.29, "Discriminator Loss": 1.1518384, "Generator GAN Loss": 1.5345688, "Generator L1 Loss": 0.08515694, "Generator Total Loss": 10.050262}, {"Step": 36000, "Time": 121.27, "Discriminator Loss": 0.7576015, "Generator GAN Loss": 1.7003558, "Generator L1 Loss": 0.09748752, "Generator Total Loss": 11.449107}, {"Step": 37000, "Time": 121.26, "Discriminator Loss": 0.68960524, "Generator GAN Loss": 1.3168797, "Generator L1 Loss": 0.08719856, "Generator Total Loss": 10.036736}, {"Step": 38000, "Time": 122.16, "Discriminator Loss": 1.8272173, "Generator GAN Loss": 3.391673, "Generator L1 Loss": 0.08450085, "Generator Total Loss": 11.841758}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>majiayue@design.upenn.edu</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>